"use strict";var WPMailSMTPDashboardWidget=window.WPMailSMTPDashboardWidget||function(e){var d={$widget:e("#wp_mail_smtp_reports_widget_pro"),$daysSelect:e("#wp-mail-smtp-dash-widget-timespan"),$emailTypeSelect:e("#wp-mail-smtp-dash-widget-email-type"),$canvas:e("#wp-mail-smtp-dash-widget-chart"),$emailStatsBlock:e("#wp-mail-smtp-dash-widget-email-stats-block"),$recomBlockDismissBtn:e("#wp-mail-smtp-dash-widget-dismiss-recommended-plugin-block"),$settingsBtn:e("#wp-mail-smtp-dash-widget-settings-button")},a=wp_mail_smtp_dashboard_widget.no_send_confirmations?[{label:wp_mail_smtp_dashboard_widget.texts.sent_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(106, 160, 139, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"},{label:wp_mail_smtp_dashboard_widget.texts.failed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(214, 54, 56, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"}]:[{label:wp_mail_smtp_dashboard_widget.texts.confirmed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(106, 160, 139, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"},{label:wp_mail_smtp_dashboard_widget.texts.unconfirmed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(167, 170, 173, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"},{label:wp_mail_smtp_dashboard_widget.texts.failed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(214, 54, 56, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)"}],i={instance:null,cachedData:{confirmed:[],unconfirmed:[],sent:[],failed:[]},settings:{type:"line",data:{labels:[],datasets:a.slice()},options:{maintainAspectRatio:!1,scales:{xAxes:[{type:"time",time:{unit:"day",tooltipFormat:"MMM D"},distribution:"series",ticks:{beginAtZero:!0,source:"labels",padding:10,minRotation:25,maxRotation:25,callback:function(a,t,e){var s=Math.floor(e.length/7);return s<1||(e.length-t-1)%s==0?a:void 0}},offset:!1,gridLines:{offsetGridLines:!1}}],yAxes:[{ticks:{beginAtZero:!0,maxTicksLimit:6,padding:20,callback:function(a){if(Math.floor(a)===a)return a}}}]},elements:{line:{tension:0}},animation:{duration:0},hover:{animationDuration:0},legend:{display:!1},tooltips:{displayColors:!1},responsiveAnimationDuration:0}},init:function(){var a;d.$canvas.length&&(a=d.$canvas[0].getContext("2d"),i.instance=new WPMailSMTPChart(a,i.settings),i.updateUI(wp_mail_smtp_dashboard_widget.chart_data))},ajaxUpdate:function(a){a={_wpnonce:wp_mail_smtp_dashboard_widget.nonce,action:"wp_mail_smtp_"+wp_mail_smtp_dashboard_widget.slug+"_get_chart_data",days:a};d.$widget.trigger("WPMailSMTP.Admin.DashboardWidget.ajaxUpdate"),e.post(ajaxurl,a,function(a){i.updateUI(a)})},updateUI:function(a){d.$widget.trigger("WPMailSMTP.Admin.DashboardWidget.updateUI");var t=d.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=style]:checked").val();e.isEmptyObject(a)?(t="line",i.updateWithDummyData(),i.showEmptyDataMessage()):(i.updateData(a),i.removeEmptyDataMessage()),i.updateColorScheme(d.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=color]:checked").val()),i.updateStyle(t),i.updateDatasets(),i.instance.update()},updateData:function(a){i.settings.data.labels=[],i.cachedData.confirmed=[],i.cachedData.unconfirmed=[],i.cachedData.sent=[],i.cachedData.failed=[],e.each(a,function(a,t){var e=moment(t.day);i.settings.data.labels.push(e),i.cachedData.confirmed.push({t:e,y:t.delivered}),i.cachedData.unconfirmed.push({t:e,y:t.sent}),i.cachedData.sent.push({t:e,y:t.sent+t.delivered}),i.cachedData.failed.push({t:e,y:t.unsent})}),i.updateChartData()},updateChartData:function(){i.settings.data.datasets=a.slice(),wp_mail_smtp_dashboard_widget.no_send_confirmations?(i.settings.data.datasets[0].data=i.cachedData.sent,i.settings.data.datasets[1].data=i.cachedData.failed):(i.settings.data.datasets[0].data=i.cachedData.confirmed,i.settings.data.datasets[1].data=i.cachedData.unconfirmed,i.settings.data.datasets[2].data=i.cachedData.failed)},updateWithEmptyData:function(){i.settings.data.labels=[];for(var a,t=moment().startOf("day"),e=d.$daysSelect.val()||7,s=1;s<=e;s++)a=t.clone().subtract(s,"days"),i.settings.data.labels.push(a)},updateWithDummyData:function(){i.settings.data.labels=[],i.settings.data.datasets[0].data=[],1<i.settings.data.datasets.length&&(i.settings.data.datasets[1].data=[]),2<i.settings.data.datasets.length&&(i.settings.data.datasets[2].data=[]);for(var a,t=moment().startOf("day"),e=d.$daysSelect.val()||7,s=1;s<=e;s++)a=t.clone().subtract(s,"days"),i.settings.data.labels.push(a),i.settings.data.datasets[0].data.push({t:a,y:Math.floor(16*Math.random())+5})},updateColorScheme:function(a){var t=d.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=style]:checked").val(),e=["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)"];"smtp"===a?e=i.updateSmtpColorScheme():"wp"===a&&(e=i.updateWpColorScheme()),"bar"===t&&(wp_mail_smtp_dashboard_widget.no_send_confirmations?(e[0]=i.settings.data.datasets[0].borderColor,e[2]=i.settings.data.datasets[1].borderColor):(e[0]=i.settings.data.datasets[0].borderColor,e[1]=i.settings.data.datasets[1].borderColor,e[2]=i.settings.data.datasets[2].borderColor)),wp_mail_smtp_dashboard_widget.no_send_confirmations?(i.settings.data.datasets[0].backgroundColor=e[0],i.settings.data.datasets[1].backgroundColor=e[2]):(i.settings.data.datasets[0].backgroundColor=e[0],i.settings.data.datasets[1].backgroundColor=e[1],i.settings.data.datasets[2].backgroundColor=e[2])},updateSmtpColorScheme:function(){var a="rgba(0, 0, 0, 0)",t="rgba(0, 0, 0, 0)",e="rgba(0, 0, 0, 0)";return"all"!==d.$emailTypeSelect.val()&&(a="rgba(106, 160, 139, 0.16)",t="rgba(167, 170, 173, 0.16)",e="rgba(214, 54, 56, 0.16)"),wp_mail_smtp_dashboard_widget.no_send_confirmations?(i.settings.data.datasets[0].borderColor="rgba(106, 160, 139, 1)",i.settings.data.datasets[1].borderColor="rgba(214, 54, 56, 1)"):(i.settings.data.datasets[0].borderColor="rgba(106, 160, 139, 1)",i.settings.data.datasets[1].borderColor="rgba(167, 170, 173, 1)",i.settings.data.datasets[2].borderColor="rgba(214, 54, 56, 1)"),[a,t,e]},updateWpColorScheme:function(){var a="rgba(0, 0, 0, 0)",t="rgba(0, 0, 0, 0)",e="rgba(0, 0, 0, 0)";return"all"!==d.$emailTypeSelect.val()&&(a="rgba(34, 113, 177, 0.16)",t="rgba(167, 170, 173, 0.16)",e="rgba(214, 54, 56, 0.16)"),wp_mail_smtp_dashboard_widget.no_send_confirmations?(i.settings.data.datasets[0].borderColor="rgba(34, 113, 177, 1)",i.settings.data.datasets[1].borderColor="rgba(214, 54, 56, 1)"):(i.settings.data.datasets[0].borderColor="rgba(34, 113, 177, 1)",i.settings.data.datasets[1].borderColor="rgba(167, 170, 173, 1)",i.settings.data.datasets[2].borderColor="rgba(214, 54, 56, 1)"),[a,t,e]},updateDatasets:function(){var a=d.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=style]:checked").val();"line"===a?i.updateLineDatasets():"bar"===a&&i.updateBarDatasets()},updateLineDatasets:function(){switch(d.$emailTypeSelect.val()){case"delivered":i.settings.data.datasets[1].data=[],wp_mail_smtp_dashboard_widget.no_send_confirmations||(i.settings.data.datasets[2].data=[]);break;case"sent":wp_mail_smtp_dashboard_widget.no_send_confirmations?i.settings.data.datasets[1].data=[]:(i.settings.data.datasets[0].data=[],i.settings.data.datasets[2].data=[]);break;case"unsent":i.settings.data.datasets[0].data=[],wp_mail_smtp_dashboard_widget.no_send_confirmations||(i.settings.data.datasets[1].data=[])}},updateBarDatasets:function(){switch(d.$emailTypeSelect.val()){case"delivered":i.settings.data.datasets=i.settings.data.datasets.slice(0,1);break;case"sent":i.settings.data.datasets=wp_mail_smtp_dashboard_widget.no_send_confirmations?i.settings.data.datasets.slice(0,1):i.settings.data.datasets.slice(1,2);break;case"unsent":i.settings.data.datasets=wp_mail_smtp_dashboard_widget.no_send_confirmations?i.settings.data.datasets.slice(1):i.settings.data.datasets.slice(2)}},updateStyle:function(a){"line"===(i.settings.type=a)?(i.settings.options.scales.xAxes[0].offset=!1,i.settings.options.scales.xAxes[0].gridLines.offsetGridLines=!1):"bar"===a&&(i.settings.options.scales.xAxes[0].offset=!0,i.settings.options.scales.xAxes[0].gridLines.offsetGridLines=!0)},showEmptyDataMessage:function(){i.removeEmptyDataMessage(),d.$canvas.after(wp_mail_smtp_dashboard_widget.empty_chart_html)},removeEmptyDataMessage:function(){d.$canvas.siblings(".wp-mail-smtp-error").remove()},events:{daysChanged:function(){var a=d.$daysSelect.val();i.ajaxUpdate(a),d.$widget.trigger("WPMailSMTP.Admin.DashboardWidget.daysChanged",a)},emailTypeChanged:function(){var a=d.$emailTypeSelect.val();i.updateChartData(),i.updateColorScheme(d.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=color]:checked").val()),i.updateDatasets(),i.instance.update(),d.$widget.trigger("WPMailSMTP.Admin.DashboardWidget.emailTypeChanged",a)}}},s={chart:i,init:function(){e(s.ready)},ready:function(){s.events(),i.init(),s.refreshEmailStats(d.$emailTypeSelect.val())},events:function(){s.chartEvents(),s.miscEvents()},chartEvents:function(){d.$daysSelect.on("change",function(){i.events.daysChanged(),s.updateEmailStats(e(this).val(),d.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=color]:checked").val())}),d.$emailTypeSelect.on("change",function(){i.events.emailTypeChanged(),s.refreshEmailStats(e(this).val())})},miscEvents:function(){d.$recomBlockDismissBtn.on("click",function(){s.dismissRecommendedBlock()}),d.$settingsBtn.on("click",function(){e(this).siblings(".wp-mail-smtp-dash-widget-settings-menu").toggle()}),d.$widget.find(".wp-mail-smtp-dash-widget-settings-menu-save").on("click",function(){s.saveSettings()}),d.$widget.on("WPMailSMTP.Admin.DashboardWidget.ajaxUpdate",function(){s.addOverlay(d.$canvas)}),d.$widget.on("WPMailSMTP.Admin.DashboardWidget.updateUI",function(){s.removeOverlay(d.$canvas)}),d.$widget.on("WPMailSMTP.Admin.DashboardWidget.daysChanged",function(a,t){s.saveWidgetMeta("timespan",t)}),d.$widget.on("WPMailSMTP.Admin.DashboardWidget.emailTypeChanged",function(a,t){s.saveWidgetMeta("email_type",t)})},updateEmailStats:function(t,a){a={_wpnonce:wp_mail_smtp_dashboard_widget.nonce,action:"wp_mail_smtp_"+wp_mail_smtp_dashboard_widget.slug+"_get_email_stats",days:t,color:a};s.addOverlay(d.$emailStatsBlock.children().first()),e.post(ajaxurl,a,function(a){d.$emailStatsBlock.html(a),s.refreshEmailStats(d.$emailTypeSelect.val()),s.saveWidgetMeta("timespan",t)})},refreshEmailStats:function(a){var t=d.$emailStatsBlock.find(".wp-mail-smtp-dash-widget-email-stats-table-cell");"all"!==a?(t.hide(),d.$emailStatsBlock.find(".wp-mail-smtp-dash-widget-email-stats-table-cell--"+a).show()):t.show()},saveSettings:function(){var a=d.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=style]:checked").val(),t=d.$widget.find(".wp-mail-smtp-dash-widget-settings-menu input[name=color]:checked").val();a&&s.saveWidgetMeta("graph_style",a),t&&s.saveWidgetMeta("color_scheme",t),s.updateEmailStats(d.$daysSelect.val(),t),i.updateChartData(),i.updateColorScheme(t),i.updateStyle(a),i.updateDatasets(),i.instance.update(),d.$widget.find(".wp-mail-smtp-dash-widget-settings-menu").hide()},saveWidgetMeta:function(a,t){t={_wpnonce:wp_mail_smtp_dashboard_widget.nonce,action:"wp_mail_smtp_"+wp_mail_smtp_dashboard_widget.slug+"_save_widget_meta",meta:a,value:t};e.post(ajaxurl,t)},addOverlay:function(a){a.parent().closest(".wp-mail-smtp-dash-widget-block").length&&(s.removeOverlay(a),a.after('<div class="wp-mail-smtp-dash-widget-overlay"></div>'))},removeOverlay:function(a){a.siblings(".wp-mail-smtp-dash-widget-overlay").remove()},dismissRecommendedBlock:function(){e(".wp-mail-smtp-dash-widget-recommended-plugin-block").remove(),s.saveWidgetMeta("hide_recommended_block",1)}};return s}((document,window,jQuery));WPMailSMTPDashboardWidget.init();