"use strict";var WPMailSmtpEmailLogsExport=window.WPMailSmtpEmailLogsExport||function(t,o){var i={$form:o("#wp-mail-smtp-tools-export-email-logs"),$type:o("#wp-mail-smtp-tools-export-email-logs-export-type input"),$dateFlatpickr:o("#wp-mail-smtp-tools-export-email-logs-date-flatpickr"),$submitButton:o("#wp-mail-smtp-tools-export-email-logs-submit"),$cancelButton:o("#wp-mail-smtp-tools-export-email-logs-cancel"),$processMsg:o("#wp-mail-smtp-tools-export-email-logs-process-msg")},a=wp_mail_smtp_tools_export_email_logs.i18n,n={},s={init:function(){o(s.ready)},ready:function(){n.processing=!1,s.initDateRange(),s.initSubmit(),s.events()},events:function(){o(t).on("csv_file_error",function(t,e){s.clearSubmitMsg(),s.addSubmitMsg(e,"error")}),i.$type.on("change",s.filterExportFieldsByType).filter(":checked").trigger("change")},exportAjaxStep:function(i,t){i=i||1,n.processing&&(t=s.getAjaxPostData(i,t),o.post(wp_mail_smtp.ajax_url,t).done(function(t){if(!(t.success&&t.data.total_steps>i)){s.clearSubmitMsg();var e="";return(clearTimeout(n.timerId),t.success)?0===t.data.count?(s.addSubmitMsg(a.prc_2_no_email_logs),void s.displaySubmitSpinner(!1)):(e=0<t.data.notices.length?a.prc_3_partially:a.prc_3_done,e+="<br>"+a.prc_3_download+', <a href="#" class="wp-mail-smtp-download-link">'+a.prc_3_click_here+"</a>.",s.addSubmitMsg(e,"info"),o.each(t.data.notices,function(t,e){s.addSubmitMsg(e.message,e.type)}),s.displaySubmitSpinner(!1),void s.triggerDownload(t.data.request_id)):(s.addSubmitMsg(t.data.error,"error"),void s.displaySubmitSpinner(!1))}s.exportAjaxStep(++i,t.data.request_id)}).fail(function(t,e,i){clearTimeout(n.timerId),s.addSubmitMsg(a.error_prefix+":<br>"+i,"error"),s.displaySubmitSpinner(!1)}))},getAjaxPostData:function(t,e){t=1===t?i.$form.serialize():{action:"wp_mail_smtp_tools_export_email_logs",nonce:wp_mail_smtp_tools_export_email_logs.nonce,request_id:e,step:t};return t},initSubmit:function(){i.$submitButton.on("click",function(t){t.preventDefault(),o(this).hasClass("wp-mail-smtp-btn-spinner-on")||(i.$submitButton.trigger("blur"),s.displaySubmitSpinner(!0),s.clearSubmitMsg(),n.timerId=setTimeout(function(){s.addSubmitMsg(a.prc_1_filtering+"<br>"+a.prc_1_please_wait,"info")},3e3),s.exportAjaxStep(1))}),i.$cancelButton.on("click",function(t){t.preventDefault(),i.$cancelButton.trigger("blur"),s.clearSubmitMsg(),s.displaySubmitSpinner(!1)})},initDateRange:function(){var t=wp_mail_smtp_tools_export_email_logs.lang_code,e={rangeSeparator:" - "};"undefined"!==flatpickr&&Object.prototype.hasOwnProperty.call(flatpickr,"l10ns")&&Object.prototype.hasOwnProperty.call(flatpickr.l10ns,t)&&((e=flatpickr.l10ns[t]).rangeSeparator=" - "),i.$dateFlatpickr.flatpickr({altInput:!0,altFormat:"M j, Y",dateFormat:"Y-m-d",locale:e,mode:"range"})},displaySubmitSpinner:function(t){t?(i.$submitButton.addClass("wp-mail-smtp-btn-spinner-on"),i.$cancelButton.removeClass("hidden"),n.processing=!0):(i.$submitButton.removeClass("wp-mail-smtp-btn-spinner-on"),i.$cancelButton.addClass("hidden"),n.processing=!1)},addSubmitMsg:function(t,e){e=e||"info",n.processing&&0!==t.length&&(Array.isArray(t)&&(t=t.join("<br>")),0<i.$processMsg.find(".notice-"+e).length?i.$processMsg.find(".notice-"+e+" p").append("<br>"+t):(e=o("<div>").addClass("notice-inline notice-"+e),t=o("<p>").html(t),e.append(t),i.$processMsg.append(e)),i.$processMsg.show())},clearSubmitMsg:function(){i.$processMsg.html("").hide()},triggerDownload:function(t){var e=wp_mail_smtp_tools_export_email_logs.export_page;e+="&action=wp_mail_smtp_tools_export_download_result",e+="&nonce="+wp_mail_smtp_tools_export_email_logs.nonce,e+="&request_id="+t,i.$form.find("iframe").remove(),i.$form.append('<iframe src="'+e+'"></iframe>'),i.$processMsg.find(".wp-mail-smtp-download-link").attr("href",e)},filterExportFieldsByType:function(){var t=o(this).val(),e=o("#wp-mail-smtp-tools-export-email-logs-common-fields"),i=o("#wp-mail-smtp-tools-export-email-logs-additional-info");"eml"===t?(e.hide(),i.hide()):(e.show(),i.show())}};return s}(document,(window,jQuery));WPMailSmtpEmailLogsExport.init();