"use strict";var WPMailSMTPEmailReports=window.WPMailSMTPEmailReports||function(t,i){var n={$canvas:i("#wp-mail-smtp-email-reports-chart"),$timespanSelect:i('.wp-mail-smtp-filter-date select[name="timespan"]'),$dateInput:i('.wp-mail-smtp-filter-date input[name="date"]'),$reportsTitle:i(".wp-mail-smtp-email-reports__title"),$spinner:i(".wp-mail-smtp-email-reports .spinner")},e=wp_mail_smtp_email_reports.no_send_confirmations?[{label:wp_mail_smtp_email_reports.texts.sent_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(106, 160, 139, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"sent"},{label:wp_mail_smtp_email_reports.texts.failed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(214, 54, 56, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"failed"}]:[{label:wp_mail_smtp_email_reports.texts.confirmed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(106, 160, 139, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"confirmed"},{label:wp_mail_smtp_email_reports.texts.unconfirmed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(167, 170, 173, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"unconfirmed"},{label:wp_mail_smtp_email_reports.texts.failed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(214, 54, 56, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"failed"}];wp_mail_smtp_email_reports.open_email_tracking&&e.push({label:wp_mail_smtp_email_reports.texts.opened_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(220, 127, 60, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"openCount"}),wp_mail_smtp_email_reports.click_link_tracking&&e.push({label:wp_mail_smtp_email_reports.texts.clicked_links,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(251, 170, 111, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"clickCount"});var l={instance:null,settings:{type:"line",data:{labels:[],datasets:e.slice()},options:{maintainAspectRatio:!1,scales:{xAxes:[{type:"time",time:{unit:"day",tooltipFormat:"MMM D"},distribution:"series",ticks:{beginAtZero:!0,source:"labels",padding:10,minRotation:25,maxRotation:25,callback:function(t,a,e){var s=Math.floor(e.length/7);return s<1||(e.length-a-1)%s==0?t:void 0}},offset:!1,gridLines:{offsetGridLines:!1}}],yAxes:[{ticks:{beginAtZero:!0,maxTicksLimit:6,padding:20,callback:function(t){if(Math.floor(t)===t)return t}}}]},elements:{line:{tension:0}},animation:{duration:0},hover:{animationDuration:0},legend:{display:!1},tooltips:{displayColors:!1},responsiveAnimationDuration:0}},init:function(){var t;n.$canvas.length&&(t=n.$canvas[0].getContext("2d"),l.instance=new WPMailSMTPChart(t,l.settings),l.updateUI(wp_mail_smtp_email_reports.stats_by_date_chart_data))},updateUI:function(t){l.updateChartData(t),l.instance.update()},updateChartData:function(t){l.settings.data.labels=[];var s={confirmed:[],unconfirmed:[],sent:[],failed:[],openCount:[],clickCount:[]};i.each(t,function(t,a){var e=moment(a.day);l.settings.data.labels.push(e),s.confirmed.push({t:e,y:a.delivered}),s.unconfirmed.push({t:e,y:a.sent}),s.sent.push({t:e,y:Number(a.sent)+Number(a.delivered)}),s.failed.push({t:e,y:a.unsent}),s.openCount.push({t:e,y:a.open_count}),s.clickCount.push({t:e,y:a.click_count})}),l.settings.data.datasets=e.slice();for(var a=0;a<l.settings.data.datasets.length;a++)l.settings.data.datasets[a].data=s[l.settings.data.datasets[a].key]}},p={chart:l,init:function(){i(p.ready)},ready:function(){p.events(),l.init(),p.updateTotalsUI(wp_mail_smtp_email_reports.stats_totals),p.initFlatpickr()},events:function(){n.$timespanSelect.on("change",function(){p.showHideDateInput()}).trigger("change"),i(t).on("click",".js-wp-mail-smtp-reset-stats",function(){p.resetStatsUI()}),i(".js-wp-mail-smtp-toggle-single-stats").on("click",p.toggleSingleStats),i(".subject-toggle-single-stats").on("click",p.subjectToggleSingleStats)},showHideDateInput:function(){var t=i(".wp-mail-smtp-filter-date"),a="wp-mail-smtp-filter-date-custom";"custom"===n.$timespanSelect.val()?t.addClass(a):t.removeClass(a)},subjectToggleSingleStats:function(t){t.preventDefault();const a=i(this),e=a.closest("tr");e.hasClass("wp-mail-smtp-active-row")||p.performToggleSingleStats(e,a.data("subject"),e.find(".js-wp-mail-smtp-toggle-single-stats"),!1)},toggleSingleStats:function(){const t=i(this);p.performToggleSingleStats(t.closest("tr"),t.data("subject"),t,t.find(".dashicons").hasClass("dashicons-dismiss"))},performToggleSingleStats:function(t,a,e,s){if(s)p.resetStatsUI();else{p.resetTableState();const i=e.find(".dashicons"),o=n.$timespanSelect.val(),r=n.$dateInput.val();n.$spinner.removeClass("wp-mail-smtp-hide"),t.addClass("wp-mail-smtp-active-row"),e.addClass("dismiss-single-stats"),i.removeClass("dashicons-chart-line").addClass("dashicons-dismiss"),p.loadSingleStats(a,o,r).done(function(t){n.$reportsTitle.html(a+'<i class="dashicons dashicons-dismiss js-wp-mail-smtp-reset-stats"></i>'),p.updateTotalsUI(t.totals),l.updateUI(t.by_date_chart_data),n.$spinner.addClass("wp-mail-smtp-hide")})}},loadSingleStats:function(t,a,e){e={_wpnonce:wp_mail_smtp_email_reports.nonce,action:"wp_mail_smtp_email_reports_get_single_stats",s:t,timespan:a,date:e};return i.post(wp_mail_smtp.ajax_url,e)},resetStatsUI:function(){wp_mail_smtp_email_reports.is_search?n.$reportsTitle.html(wp_mail_smtp_email_reports.texts.search_results):n.$reportsTitle.html(wp_mail_smtp_email_reports.texts.all_emails),p.updateTotalsUI(wp_mail_smtp_email_reports.stats_totals),l.updateUI(wp_mail_smtp_email_reports.stats_by_date_chart_data),p.resetTableState()},resetTableState:function(){const t=i(".wp-list-table");t.find(".wp-mail-smtp-active-row").removeClass("wp-mail-smtp-active-row"),t.find(".dashicons-dismiss").removeClass("dashicons-dismiss").addClass("dashicons-chart-line"),t.find(".dismiss-single-stats").removeClass("dismiss-single-stats")},updateTotalsUI:function(t){var a,e;null!==t&&(e=(a=Number(t.sent)+Number(t.delivered))+Number(t.unsent),i(".wp-mail-smtp-email-reports__stats-item--total span").text(e),i(".wp-mail-smtp-email-reports__stats-item--unsent span").text(t.unsent),wp_mail_smtp_email_reports.no_send_confirmations?i(".wp-mail-smtp-email-reports__stats-item--sent span").text(a):(i(".wp-mail-smtp-email-reports__stats-item--confirmed span").text(t.delivered),i(".wp-mail-smtp-email-reports__stats-item--unconfirmed span").text(t.sent)),wp_mail_smtp_email_reports.open_email_tracking&&i(".wp-mail-smtp-email-reports__stats-item--open-count span").text(t.open_count),wp_mail_smtp_email_reports.click_link_tracking&&i(".wp-mail-smtp-email-reports__stats-item--click-count span").text(t.click_count))},initFlatpickr:function(){var t={rangeSeparator:" - "},a={altInput:!0,altFormat:"M j, Y",dateFormat:"Y-m-d",mode:"range",maxDate:moment().subtract(1,"days").toDate()};"undefined"!==flatpickr&&Object.prototype.hasOwnProperty.call(flatpickr,"l10ns")&&Object.prototype.hasOwnProperty.call(flatpickr.l10ns,wp_mail_smtp.lang_code)&&((t=flatpickr.l10ns[wp_mail_smtp.lang_code]).rangeSeparator=" - "),a.locale=t,i(".wp-mail-smtp-filter-date-selector").flatpickr(a)}};return p}(document,(window,jQuery));WPMailSMTPEmailReports.init();